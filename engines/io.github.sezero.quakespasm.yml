name: quakespasm
sources:
  - type: archive
    url: https://api.github.com/repos/sezero/quakespasm/zipball/quakespasm-0.96.3
    sha256: 06a0e48c613388f51d05a0bb51afe027e15db012ec57615d82d5d6bbfd244066
    dest-filename: quakespasm.zip
    x-checker-data:
      type: json
      url: https://api.github.com/repos/sezero/quakespasm/releases/latest
      version-query: .tag_name | sub("quakespasm-"; "")
      url-query: .zipball_url
  - type: file
    url: https://raw.githubusercontent.com/lavenderdotpet/LibreQuake/e38e5fc2ddb0b0aa422a2be9c120fb798d67a318/docs/flatpak-metadata/io.github.lavenderdotpet.LibreQuake.svg
    sha256: 9ebe794eed8d4a27db3f06ad6002390472c32b31fa6b22ffa945543cf3cca222
    dest-filename: io.github.lavenderdotpet.LibreQuake.svg
  - type: patch
    path: io.github.sezero.quakespasm.userdir_log.patch
no-autogen: true
no-make-install: true
subdir: Quake
make-args:
  - DEBUG=1
  - DO_USERDIRS=1
  - USE_SDL2=1
  - USE_CODEC_XMP=1
  - USE_CODEC_FLAC=1
  - USE_CODEC_OPUS=1
  - USE_CODEC_UMX=1
  - MP3LIB=mpg123
  - LDFLAGS="-L/app/lib"
post-install:
  - install -D -m755 -t /app/bin/ quakespasm
  - install -D -m644 ${FLATPAK_BUILDER_BUILDDIR}/io.github.lavenderdotpet.LibreQuake.svg /app/share/icons/hicolor/scalable/apps/io.github.lavenderdotpet.LibreQuake.quakespasm.svg
