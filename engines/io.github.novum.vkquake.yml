name: vkquake
modules:
  - name: spirv-tools
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://api.github.com/repos/KhronosGroup/SPIRV-Tools/zipball/vulkan-sdk-1.3.296.0
        sha256: e185f6f5de99bf426487e12ed705d6a6ef87f1a780457bb8e2a43e14ef13f8a0
        dest-filename: spirv-tools.zip
        x-checker-data:
          type: json
          url: https://api.github.com/repos/KhronosGroup/SPIRV-Tools/releases/latest
          version-query: .tag_name | sub("vulkan-sdk-"; "")
          url-query: .zipball_url
      - type: archive
        url: https://api.github.com/repos/KhronosGroup/SPIRV-Headers/zipball/vulkan-sdk-1.3.296.0
        sha256: 35504076dbd25a7d82d37183f13d668c6f16f2e036798f2ebc906da4f68d0037
        dest-filename: spirv-headers.zip
        dest: external/spirv-headers
        x-checker-data:
          type: json
          url: https://api.github.com/repos/KhronosGroup/SPIRV-Headers/releases/latest
          version-query: .tag_name | sub("vulkan-sdk-"; "")
          url-query: .zipball_url
sources:
  - type: archive
    url: https://api.github.com/repos/novum/vkquake/zipball/1.32.3.1
    sha256: d71280f852031ec36e7efda2ecb6c2a259fe904ff80e5de2231c8825d4acf738
    dest-filename: vkquake.zip
    x-checker-data:
      type: json
      url: https://api.github.com/repos/novum/vkquake/releases/latest
      version-query: .tag_name
      url-query: .zipball_url
  - type: patch
    path: io.github.novum.vkquake.userdir_log.patch
  - type: file
    path: io.github.sezero.quakespasm.png
buildsystem: meson
config-opts:
  - -Ddo_userdirs=enabled
  - -Ddebug=true
post-install:
  - install -D -m755 -t /app/bin/ vkquake
  - install -D -m644 -t /app/bin/ ../Quake/vkquake.pak
  - install -Dm644 ../io.github.sezero.quakespasm.png /app/share/icons/hicolor/256x256/apps/io.github.lavenderdotpet.LibreQuake.quakespasm.png
